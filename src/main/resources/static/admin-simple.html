<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>戒烟APP管理后台</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            padding: 20px 0;
        }
        
        .sidebar h2 {
            text-align: center;
            margin-bottom: 30px;
            padding: 0 20px;
        }
        
        .nav-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.3s;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background: #34495e;
        }
        
        .nav-item.active {
            background: #3498db;
            border-left-color: #2980b9;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-header h2 {
            color: #2c3e50;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .alert {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
            
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .table tr:hover {
            background: #f5f5f5;
        }
        
        .parent-category {
            background: #f8f9fa !important;
            font-weight: bold;
            border-left: 4px solid #3498db;
        }
        
        .child-category {
            background: #ffffff;
            padding-left: 30px;
        }
        
        .child-category .category-name {
            padding-left: 20px;
            position: relative;
        }
        
        .child-category .category-name::before {
            content: " ";
            color: #666;
            position: absolute;
            left: 0;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close {
            font-size: 24px;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .search-box input,
        .search-box select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-top: 20px;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .category-icon {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            object-fit: cover;
        }
        
        .no-data {
            text-align: center;
            color: #999;
            font-style: italic;
        }</style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2>管理后台</h2>
            <div class="nav-item active" onclick="showDashboard()">仪表盘</div>
            <div class="nav-item" onclick="showKnowledgeCategories()">知识分类</div>
            <div class="nav-item" onclick="showArticles()">知识文章</div>
            <div class="nav-item" onclick="showUsers()">用户管理</div>
            <div class="nav-item" onclick="showAudios()">音频管理</div>
        </div>
        
        <div class="main-content">
            <!-- 仪表盘 -->
            <div id="dashboard" class="content-section active">
                <div class="section-header">
                    <h2>系统概览</h2>
                </div>
                <div class="stats-grid" id="statsGrid">
                    <div class="loading">加载中...</div>
                </div>
            </div>
            
            <!-- 知识分类管理 -->
            <div id="knowledgeCategories" class="content-section">
                <div class="section-header">
                    <h2>知识分类管理</h2>
                    <button class="btn btn-success" onclick="showAddCategoryModal()">添加分类</button>
                </div>
                <div id="categoryContent">
                    <div class="loading">加载中...</div>
                </div>
            </div>
            
            <!-- 知识文章管理 -->
            <div id="articles" class="content-section">
                <div class="section-header">
                    <h2>知识文章管理</h2>
                </div>
                <div class="loading">文章管理功能开发中...</div>
            </div>
            
            <!-- 用户管理 -->
            <div id="users" class="content-section">
                <div class="section-header">
                    <h2>用户管理</h2>
                </div>
                <div class="loading">用户管理功能开发中...</div>
            </div>
            
            <!-- 音频管理 -->
            <div id="audios" class="content-section">
                <div class="section-header">
                    <h2>音频管理</h2>
                </div>
                <div class="loading">音频管理功能开发中...</div>
            </div>
        </div>
    </div>
    
    <script>
        // 全局变量
        let currentSection = 'dashboard';
        
        // 显示指定部分
        function showSection(sectionId, targetElement = null) {
            console.log('切换到部分:', sectionId);
            
            // 隐藏所有部分
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // 移除所有导航项的active类
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 显示指定部分
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // 激活对应导航项
            if (targetElement) {
                targetElement.classList.add('active');
            }
            
            // 更新当前部分
            currentSection = sectionId;
            
            // 加载对应数据
            loadSectionData(sectionId);
        }
        
        // 显示仪表盘
        function showDashboard() {
            console.log('显示仪表盘');
            showSection('dashboard', event.target);
        }
        
        // 显示知识分类管理
        function showKnowledgeCategories() {
            console.log('显示知识分类');
            showSection('knowledgeCategories', event.target);
        }
        
        // 显示文章管理
        function showArticles() {
            console.log('显示文章管理');
            showSection('articles', event.target);
        }
        
        // 显示用户管理
        function showUsers() {
            console.log('显示用户管理');
            showSection('users', event.target);
        }
        
        // 显示音频管理
        function showAudios() {
            console.log('显示音频管理');
            showSection('audios', event.target);
        }
        
        // 加载部分数据
        function loadSectionData(sectionId) {
            console.log('加载数据:', sectionId);
            switch(sectionId) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'knowledgeCategories':
                    loadCategories();
                    break;
                case 'articles':
                    // 文章功能待开发
                    break;
                case 'users':
                    // 用户功能待开发
                    break;
                case 'audios':
                    // 音频功能待开发
                    break;
            }
        }
        
        // 加载仪表盘数据
        async function loadDashboard() {
            console.log('开始加载仪表盘数据');
            try {
                const response = await fetch('/api/v1/admin/stats');
                console.log('仪表盘API响应状态:', response.status);
                
                const data = await response.json();
                console.log('仪表盘API数据:', data);
                
                if (data.code === 200) {
                    displayStats(data.data);
                } else {
                    document.getElementById('statsGrid').innerHTML = '<div class="alert alert-error">加载统计数据失败: ' + data.message + '</div>';
                }
            } catch (error) {
                console.error('加载仪表盘失败:', error);
                document.getElementById('statsGrid').innerHTML = '<div class="alert alert-error">加载统计数据失败: ' + error.message + '</div>';
            }
        }
        
        // 显示统计数据
        function displayStats(stats) {
            console.log('显示统计数据:', stats);
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.totalUsers || 0}</div>
                    <div class="stat-label">总用户数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.activeUsers || 0}</div>
                    <div class="stat-label">活跃用户</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.totalAudios || 0}</div>
                    <div class="stat-label">总音频数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.publicAudios || 0}</div>
                    <div class="stat-label">公有音频</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.totalSmokingRecords || 0}</div>
                    <div class="stat-label">吸烟记录</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.totalTrainingRecords || 0}</div>
                    <div class="stat-label">训练记录</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.newUsersToday || 0}</div>
                    <div class="stat-label">今日新增用户</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.premiumUsers || 0}</div>
                    <div class="stat-label">会员用户</div>
                </div>
            `;
        }
        
        // 加载分类数据
        async function loadCategories() {
            console.log('开始加载分类数据');
            try {
                const response = await fetch('/api/v1/knowledge/categories');
                console.log('分类API响应状态:', response.status);
                
                const data = await response.json();
                console.log('分类API数据:', data);
                
                if (data.content && Array.isArray(data.content)) {
                    displayCategories(data.content);
                } else {
                    document.getElementById('categoryContent').innerHTML = '<div class="alert alert-error">暂无分类数据</div>';
                }
            } catch (error) {
                console.error('加载分类失败:', error);
                document.getElementById('categoryContent').innerHTML = '<div class="alert alert-error">加载分类失败: ' + error.message + '</div>';
            }
        }
        
        // 显示分类列表
        function displayCategories(categories) {
            console.log('显示分类数据:', categories);
            const categoryContent = document.getElementById('categoryContent');
            
            if (categories.length === 0) {
                categoryContent.innerHTML = '<div class="alert alert-error">暂无分类数据</div>';
                return;
            }
            
            let html = '<div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">';
            html += '<h3>分类列表</h3>';
            html += '<ul>';
            categories.forEach(category => {
                html += `<li>${category.name} (ID: ${category.id})</li>`;
            });
            html += '</ul>';
            html += '</div>';
            
            categoryContent.innerHTML = html;
        }
        
        // 显示提示信息
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = 'alert alert-' + type;
            alert.textContent = message;
            
            const container = document.querySelector('.main-content');
            container.insertBefore(alert, container.firstChild);
            
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }
        
        // 其他功能待实现
        function showAddCategoryModal() {
            showAlert('添加分类功能开发中...', 'error');
        }
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面加载完成，开始初始化');
            loadDashboard();
        });
        
        // 捕获JavaScript错误
        window.onerror = function(msg, url, line, col, error) {
            console.error('JavaScript错误:', msg, '在', url, '第', line, '行');
            showAlert('JavaScript错误: ' + msg, 'error');
            return true;
        };
    </script>
    
    <!-- 添加分类模态框 -->
    <div id="addCategoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加知识分类</h3>
                <span class="close" onclick="closeAddCategoryModal()">&times;</span>
            </div>
            <form id="addCategoryForm">
                <div class="form-group">
                    <label>分类名称 *</label>
                    <input type="text" id="categoryName" placeholder="请输入分类名称" required>
                </div>
                <div class="form-group">
                    <label>分类描述</label>
                    <textarea id="categoryDescription" placeholder="请输入分类描述..." style="height: 100px;"></textarea>
                </div>
                <div class="form-group">
                    <label>父分类</label>
                    <select id="categoryParentId">
                        <option value="">无（顶级分类）</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>排序</label>
                    <input type="number" id="categorySortOrder" placeholder="数字越小排序越靠前" value="0">
                </div>
                <div class="form-group">
                    <label>访问权限 *</label>
                    <select id="categoryAccessLevel">
                        <option value="free">免费</option>
                        <option value="member">会员</option>
                        <option value="premium">高级会员</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>会员限制</label>
                    <select id="categoryMemberOnly">
                        <option value="false">所有用户可访问</option>
                        <option value="true">仅会员可访问</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>状态</label>
                    <select id="categoryIsActive">
                        <option value="true">启用</option>
                        <option value="false">禁用</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="button" class="btn" onclick="closeAddCategoryModal()">取消</button>
                    <button type="button" class="btn btn-success" onclick="submitAddCategory()">添加分类</button>
                </div>
            </form>
        </div>
    </div></body>
</html>